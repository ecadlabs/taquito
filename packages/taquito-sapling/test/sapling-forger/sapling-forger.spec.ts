import { SaplingForger } from '../../src/sapling-forger/sapling-forger';
import { outputDescription, spendDescription } from '../data/sapling_test_data';

describe('Sapling Forger tests', () => {
  const forger = new SaplingForger();

  it('should be able to forge spendDescriptions', () => {
    const forged = forger.forgeSpendDescriptions(spendDescription);

    expect(forged).toBeDefined();
    expect(forged.length).toBeGreaterThan(0);
    expect(forged.toString('hex')).toEqual(
      '29903c784606d64aca3bcaa6774dda35c1e727dfff92f3d9b365f01214f8f76174657374317465737432b4d81b58638d535275111ab1df4e0289248c7510bc8c09e96f73cc446bda300d17455230448c4d67792358b8903bfbbca2135ca487cb447025ac8abbb2f4913f12cba1b7a72b601af99702336f54e1d95749968c34cc84eaf41c8c1ad77159a10dec8091ad5d8c7d17eec384886c204646a106d69895b10f26d4ff7ae57e8f8cc362983fc19c47f00d235e3d3abc7561838e749c54622f445e074d59091447270b8c555d3568f437fa95c02b71f028ddc364f2f78d63d287e28f74c554eb310c74657374347465737435746573743674657374377369676f696f44536d42537a48695075325334504852666e77394a416f7652734a526d77744a65486766643531377166633462485476384b41534e42635976726a416d3642696e63753770446b69415164775a77756a7176734273706e517552'
    );
  });

  it('should be able to forge outputDescriptions', () => {
    const forged = forger.forgeOutputDescriptions(outputDescription);

    expect(forged).toBeDefined();
    expect(forged.length).toBeGreaterThan(0);
    expect(forged.toString('hex')).toEqual(
      '29903c784606d64aca3bcaa6774dda35c1e727dfff92f3d9b365f01214f8f7619a1ebe13be50701d802c60db1f1d73d82f7b0b5aae53deed1252f326141aab3a0000009e86413ef92762cea59b418d73284298254ee3a16ce85c5bde80391c56d64ecb8730f66dc28492305e33f5f187b795e0914873b65c030c8198365ea87c5fb2b5c3e8efb9b86c3badc4f054caf53cda8300c4991af491d2677166fbdc0828519f7e44d8ea66ce56ace4f7436d591f59694a90fb2d0ed5d001b00f78939a2b5a4f0349469a44718fa4160632cc3fd0ffa25698f6e7e6a57f3d11c4bd8645a9357dca54aa849687097005daee7875b4fb770801261b7678a0e9612d936ab32db491301bd2c145690c4846024ccc342e7261'
    );
  });

  it('should be able to forge Sapling transactions', () => {
    const forged = forger.forgeSaplingTransaction(
      spendDescription,
      outputDescription,
      Buffer.from(
        'sigoioDSmBSzHiPu2S4PHRfnw9JAovRsJRmwtJeHgfd517qfc4bHTv8KASNBcYvrjAm6Bincu7pDkiAQdwZwujqvsBspnQuR',
        'hex'
      ),
      Buffer.from('123'),
      Buffer.from('root'),
      Buffer.from('00000000', 'hex')
    );

    expect(forged).toBeDefined();
    expect(forged.length).toBeGreaterThan(0);
    expect(forged.toString('hex')).toEqual(
      '0000015e29903c784606d64aca3bcaa6774dda35c1e727dfff92f3d9b365f01214f8f76174657374317465737432b4d81b58638d535275111ab1df4e0289248c7510bc8c09e96f73cc446bda300d17455230448c4d67792358b8903bfbbca2135ca487cb447025ac8abbb2f4913f12cba1b7a72b601af99702336f54e1d95749968c34cc84eaf41c8c1ad77159a10dec8091ad5d8c7d17eec384886c204646a106d69895b10f26d4ff7ae57e8f8cc362983fc19c47f00d235e3d3abc7561838e749c54622f445e074d59091447270b8c555d3568f437fa95c02b71f028ddc364f2f78d63d287e28f74c554eb310c74657374347465737435746573743674657374377369676f696f44536d42537a48695075325334504852666e77394a416f7652734a526d77744a65486766643531377166633462485476384b41534e42635976726a416d3642696e63753770446b69415164775a77756a7176734273706e5175520000011329903c784606d64aca3bcaa6774dda35c1e727dfff92f3d9b365f01214f8f7619a1ebe13be50701d802c60db1f1d73d82f7b0b5aae53deed1252f326141aab3a0000009e86413ef92762cea59b418d73284298254ee3a16ce85c5bde80391c56d64ecb8730f66dc28492305e33f5f187b795e0914873b65c030c8198365ea87c5fb2b5c3e8efb9b86c3badc4f054caf53cda8300c4991af491d2677166fbdc0828519f7e44d8ea66ce56ace4f7436d591f59694a90fb2d0ed5d001b00f78939a2b5a4f0349469a44718fa4160632cc3fd0ffa25698f6e7e6a57f3d11c4bd8645a9357dca54aa849687097005daee7875b4fb770801261b7678a0e9612d936ab32db491301bd2c145690c4846024ccc342e7261313233726f6f7400000000'
    );
  });
});
