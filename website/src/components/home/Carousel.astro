---
import hero1 from '../../images/carousel/hero-1.png';
import hero2 from '../../images/carousel/hero-2.png';

const images = [
  { src: hero1, alt: 'Hero 1' },
  { src: hero2, alt: 'Hero 2' }
];
---

<section
  class="carousel-container px-8 pb-4"
  role="region"
  aria-roledescription="carousel"
  aria-label="Featured images"
>
  <div class="md:w-1/2 mx-auto max-w-4xl">
    <div class="carousel-wrapper relative">
      <div class="carousel-track-container relative overflow-hidden rounded-3xl border-24 border-primary bg-primary">
        <div class="carousel-track flex transition-transform duration-700 ease-in-out" aria-live="polite">
          {images.map((image, index) => (
            <img
              src={image.src.src}
              alt={image.alt}
              class="carousel-image w-full h-auto shrink-0"
              data-index={index}
              aria-hidden={index !== 0}
            />
          ))}
          <img
            src={images[0].src.src}
            alt={images[0].alt}
            class="carousel-image w-full h-auto shrink-0"
            data-index="clone"
            aria-hidden="true"
          />
        </div>
      </div>

      <div class="sr-only" aria-live="polite" id="carousel-status">
        Slide 1 of {images.length}
      </div>

      <div class="carousel-dots flex justify-center gap-3 mt-6" role="tablist" aria-label="Slide indicators">
        {images.map((_, index) => (
          <button
            type="button"
            role="tab"
            aria-selected={index === 0}
            aria-label={`Go to slide ${index + 1} of ${images.length}`}
            class={`carousel-dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-primary w-6' : 'bg-primary/40'}`}
            data-index={index}
          />
        ))}
      </div>
    </div>
  </div>
</section>

<script>
  let currentIndex = 0;
  const track = document.querySelector('.carousel-track') as HTMLElement;
  const dots = document.querySelectorAll('.carousel-dot') as NodeListOf<HTMLButtonElement>;
  const images = document.querySelectorAll('.carousel-image') as NodeListOf<HTMLImageElement>;
  const status = document.getElementById('carousel-status');
  const totalRealSlides = dots.length;
  let autoPlayInterval: number;
  let isAnimating = false;

  function updateAccessibility(index: number) {
    // Update aria-hidden on images
    images.forEach((img, i) => {
      const imgIndex = img.dataset.index;
      if (imgIndex === 'clone') {
        img.setAttribute('aria-hidden', 'true');
      } else {
        img.setAttribute('aria-hidden', String(Number(imgIndex) !== index));
      }
    });

    // Update screen reader status
    if (status) {
      status.textContent = `Slide ${index + 1} of ${totalRealSlides}`;
    }
  }

  function updateDots(index: number) {
    dots.forEach((dot, i) => {
      if (i === index) {
        dot.classList.remove('bg-primary/40', 'w-3');
        dot.classList.add('bg-primary', 'w-6');
        dot.setAttribute('aria-selected', 'true');
      } else {
        dot.classList.add('bg-primary/40', 'w-3');
        dot.classList.remove('bg-primary', 'w-6');
        dot.setAttribute('aria-selected', 'false');
      }
    });
  }

  function slideToPosition(position: number, animate: boolean = true) {
    if (!track) return;
    
    const slideWidth = 100;
    if (!animate) {
      track.style.transition = 'none';
    }
    track.style.transform = `translateX(-${position * slideWidth}%)`;
    
    if (!animate) {
      void track.offsetHeight;
      track.style.transition = '';
    }
  }

  function showImage(index: number, animate: boolean = true) {
    if (!track) return;

    slideToPosition(index, animate);
    const displayIndex = index % totalRealSlides;
    updateDots(displayIndex);
    updateAccessibility(displayIndex);
    currentIndex = index;
  }

  function nextImage() {
    if (isAnimating) return;
    isAnimating = true;
    
    const nextIndex = currentIndex + 1;
    showImage(nextIndex, true);
    
    if (nextIndex === totalRealSlides) {
      setTimeout(() => {
        showImage(0, false);
        isAnimating = false;
      }, 700);
    } else {
      setTimeout(() => {
        isAnimating = false;
      }, 700);
    }
  }

  function goToSlide(index: number) {
    if (isAnimating || index === currentIndex) return;
    isAnimating = true;
    showImage(index, true);
    setTimeout(() => {
      isAnimating = false;
    }, 700);
  }

  function startAutoPlay() {
    autoPlayInterval = window.setInterval(nextImage, 8000);
  }

  function resetAutoPlay() {
    clearInterval(autoPlayInterval);
    startAutoPlay();
  }

  // Add click handlers to dots
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      goToSlide(index);
      resetAutoPlay();
    });
  });

  startAutoPlay();
</script>

<style>
  .carousel-image {
    display: block;
  }

  .carousel-dot {
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .carousel-dot:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>